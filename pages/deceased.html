<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Remember Me</title>
		<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/remixicon@2.2.0/fonts/remixicon.css'>
		<link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700,800|Roboto:400,500,700" rel="stylesheet">
		<link type="text/css" href="../assets/css/theme.css" rel="stylesheet">
		<link type="text/css" href="../assets/css/demo.css" rel="stylesheet">
		<style>
			body {
				font-family: 'Roboto', Tahoma, Geneva, Verdana, sans-serif;
				background-image: url('../assets/images/lp-bg-2.png');
				background-position: center 0;
				background-repeat: no-repeat;
				background-attachment: fixed;
				background-size: cover;
				-webkit-background-size: cover;
				-o-background-size: cover;
				-moz-background-size: cover;
				-ms-background-size: cover;
			}

			.field {
				display: inline-block;
				margin-bottom: 3px;
			}

			#list {
				width: 435px;
				height: 70%;
				min-height: 400px;
				overflow-x: hidden;
				overflow-y: scroll;
				background: none;
				color: #ffffff;
				text-align: left;
				position: absolute;
				bottom: 90px;
			}

			#list::-webkit-scrollbar {
				display: none;
				visibility: hidden;
			}

			#list p {
				line-height: 25px;
				padding: 0px;
				margin: 0px;
			}

			.comment-box {
				margin-top: 10px;
				margin-right: 50px;
				padding: 0px;
			}

			.comment-content {
				line-height: 15px;
				padding: 0px;
				margin: 0px;
			}
		</style>
		<script src="../assets/js/jquery.min.js"></script>
		<script src="../assets/layer/layer.js"></script>
		<script type="text/javascript">
			function tsinfo(info) {
				layer.alert(info, {
					title: false,
					skin: 'layui-layer-molv',
					closeBtn: 0
				});
			}
		</script>
		<script src="../assets/js/info.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-expand-lg navbar-transparent navbar-dark bg-dark py-4">
			<div class="container">
				<a class="navbar-brand" href="./homepage.html"><strong>RememberMe</strong></a>
				<button class="navbar-toggler" type="button" data-action="offcanvas-open" data-target="#navbar_main"
					aria-controls="navbar_main" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="navbar-collapse offcanvas-collapse" id="navbar_main">
					<ul class="navbar-nav ml-auto align-items-lg-center">
						<li class="nav-item ">
							<a class="nav-link" href="./individual.html">个人星球</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="./topic.html">专题星球</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="./about.html">关于我们</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="./user.html"><span><img src="../assets/images/lp-4.jpg"
										width="30px" id="profilePhoto" class="rounded-circle"></span></a>
						</li>
					</ul>
				</div>
			</div>
		</nav>
		<div class="container">
			<div class="row">
				<div class="col-8">
					<div class="container">
						<br><br><br><br><br>
						<div class="row cols-xs-space cols-sm-space cols-md-space">
							<div class="col-lg-12">
								<div class="card" style="background-color: while;opacity: 0.5;">
									<div class="card-body">
										<h4 class="heading h4" style="color: black;" id="name"><strong>Le Petit
												Prince</strong>
										</h4>
										<div class="container">
											<div class="row">
												<div class="col-4">
													<div class="row">
														<div class="col-6">
															<p style="color: black;" id="sex">Male</p>
															<p style="color: black;" id="country">France</p>
															<p style="color: black;" id="birth">1942.10.23</p>
															<p style="color: black;" id="death">1943.2.7</p>
														</div>
														<div class="col-6">
															<img src="../assets/images/lp-profile.png"
																class="avatar avatar-lg mr-3" id="starPhoto">
														</div>
													</div>
													<div class="row">
														<div class="btn-group btn-action-label" id="rose" role="group"
															aria-label="Like">
															<a href="#" data-toggle="tooltip" title="赠送玫瑰"
																class="btn btn-sm btn-outline-dark btn-label">99</a>
															<button type="button"
																class="btn btn-sm btn-danger btn-action">
																<i class="ri-command-line"></i>
															</button>
														</div>
														<div class="btn-group btn-action-label" role="group"
															aria-label="Like">
															<a href="#" id="collect" data-toggle="tooltip" title="收藏"
																class="btn btn-sm btn-outline-dark btn-label">9</a>
															<button type="button"
																class="btn btn-sm btn-primary btn-action">
																<i class="ri-star-line"></i>
															</button>
														</div>
													</div>
												</div>
												<div class="col-8">
													<p style="color: black;" id="exp">
														生平经历：小王子从自己星球出发前往地球，一路探险，小王子孩子式的眼光，透视出成人的空虚、盲目，愚妄和死板教条，浅显天真的语言写出了人类的孤独寂寞、没有根基随风流浪的命运。同时，小王子也满怀对金钱关系的批判，对真善美的讴歌。
													</p>
													<p style="color: black;" id="mzm">
														墓志铭：他并没有消失什么，不过感受了一次海水的变幻，化成富丽珍奇的瑰宝</p>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<br><br>
						<div class="row cols-xs-space cols-sm-space cols-md-space">
							<div class="col-lg-3">
								<div class="card bg-dark alpha-container text-white border-0 overflow-hidden">
									<a href="#" target="_blank">
										<div class="card-img-bg" id="p1"
											style="background-image: url('../assets/images/lp-1.jpg');"></div>
										<div class="card-body px-5 py-5">
											<div style="min-height: 100px;">
											</div>
										</div>
									</a>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="card bg-dark alpha-container text-white border-0 overflow-hidden">
									<a href="#" target="_blank">
										<div class="card-img-bg" id="p2"
											style="background-image: url('../assets/images/lp-2.jpg');"></div>
										<div class="card-body px-5 py-5">
											<div style="min-height: 100px;">
											</div>
										</div>
									</a>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="card bg-dark alpha-container text-white border-0 overflow-hidden">
									<a href="#" target="_blank">
										<div class="card-img-bg" id="p3"
											style="background-image: url('../assets/images/lp-3.jpg');"></div>
										<div class="card-body px-5 py-5">
											<div style="min-height: 100px;">
											</div>
										</div>
									</a>
								</div>
							</div>
							<div class="col-lg-3">
								<div class="card bg-dark alpha-container text-white border-0 overflow-hidden">
									<a href="#" target="_blank">
										<div class="card-img-bg" id="p4"
											style="background-image: url('../assets/images/lp-4.jpg');"></div>
										<div class="card-body px-5 py-5">
											<div style="min-height: 100px;">
											</div>
										</div>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="col-4">
					<div id="list">
					</div>
					<div class="container" style="position: absolute;bottom:10px;">
						<div class="row">
							<div class="input-group input-group-sm">
								<input id="demo_text" type="text" class="form-control" placeholder="Leave your message"
									style="background-color: transparent;color: aliceblue;"
									aria-describedby="button-addon4">
								<div class="input-group-append" id="button-addon4">
									<button class="btn btn-light" onclick="send_pl()" type="button" id="public">公开</button>
									<button class="btn btn-light" onclick="send_pl();" type="button" id="private">私密</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>

<!-- 获得从constellation传来的id -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	//console.log(sid);
</script>
<!-- 查询逝者信息和星球图片 -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	document.querySelector("html").onloadstart = function() {
		var xhr = new XMLHttpRequest();
		xhr.open('post', '../api/deceased/tocharacterstar.php');
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var arr = JSON.parse(xhr.responseText);
				document.getElementById("lifetime").innerHTML = arr.lifetime;
				document.getElementById("epitaph").innerHTML = arr.epitaph;
				document.getElementById("cname").innerHTML = arr.cname;
				document.getElementById("gender").innerHTML = arr.gender;
				document.getElementById("country").innerHTML = arr.country;
				document.getElementById("birth").innerHTML = arr.birth;
				document.getElementById("death").innerHTML = arr.death;
				document.getElementById('starPhoto').attr('scr', arr.starPhoto);
			}
		}
		xhr.send(sid);
	}
</script>
<!-- 逝者图片和背景图片 -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	document.querySelector("html").onloadstart = function() {
		var xhr = new XMLHttpRequest();
		xhr.open('post', '../api/deceased/character_images.php');
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var arr = JSON.parse(xhr.responseText);
				document.getElementById("p1").style.backgroundImage = arr.p1;
				document.getElementById("p2").style.backgroundImage = arr.p2;
				document.getElementById("p3").style.backgroundImage = arr.p3;
				document.getElementById("p4").style.backgroundImage = arr.p4;
				var style;
				style = document.createElement('style');
				style.innerHTML = 'body{background-image:' + arr.starBg + '!important;}';
			}
		}
		xhr.send(sid);
	}
</script>
<!-- 收藏数和玫瑰数,属性名后台修改为co_num和ro_num -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	document.querySelector("html").onloadstart = function() {
		var xhr = new XMLHttpRequest();
		xhr.open('post', '../api/deceased/readroseandcollection.php');
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var arr = JSON.parse(xhr.responseText);
				document.getElementById("collect").innerHTML = arr.co_num;
				document.getElementById("rose").innerHTML = arr.ro_num;
			}
		}
		xhr.send(sid);
	}
</script>
<!-- 收藏与取消收藏 -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	$(function() {
		$("collect").click(function() {
			var xhr = new XMLHttpRequest();
			xhr.open('post', '../api/deceased/collect.php')
			xhr.onreadystatechange = function() {
				if (xhr.readyState == 4 && xhr.status == 200) {
					var text = xhr.responseText;
					var co_num = $(this).innerHTML;
					if (text == "收藏成功") {
						$(this).innerHTML = co_num + 1;
					} else if (text == "取消收藏成功") {
						$(this).innerHTML = co_num - 1;
					} else {
						$(this).innerHTML = co_num;
					}
				}
			}
			xhr.send(sid);
		})
	})

	$(function() {
		$("rose").click(function() {
			var xhr = new XMLHttpRequest();
			xhr.open('post', '../api/deceased/send_rose.php')
			xhr.onreadystatechange = function() {
				if (xhr.readyState == 4 && xhr.status == 200) {
					var text = xhr.responseText;
					var ro_num = $(this).innerHTML;
					if (text == "送玫瑰成功") {
						$(this).innerHTML = ro_num + 1;
					} else if (text == "账户余额不足") {
						$(this).innerHTML = ro_num;
					}
				}
			}
			xhr.send(sid);
		})
	})
</script>
<!-- read message -->
<script>
	function getParams(key) {
		var reg = new RegExp("(^|&)" + key + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if (r != null) {
			return unescape(r[2]);
		}
		return null;
	};
	var sid = getParams("sid");
	window.onload = function() {
		var xhr = new XMLHttpRequest();
		xhr.open('post', '../api/deceased/read_message.php');
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				var arr = JSON.parse(xhr.responseText);
				for (var i = 0; i < arr.length; i++) {
					var msg = arr[i].mcontent;
					var time=arr[i].mtime;
					var ids =arr[i].mid;
					var list = document.getElementById("list");
					var div = document.createElement('div');
					div.className = 'comment-box clearfix';
					var html = ' <img src="images/my.jpg"  class="myhead" alt="" />' +
						'<p class="comment-text">' + time + '</p>' +
						'<div class="comment-content">' +
						'<p class="comment-text">' + msg + '</p>' +
						'<p class="comment-btn">' +
						'<a href="javascript:dz(\'' + ids +
						'\');" title="点赞"><img src="../assets/images/dz.png" border="0" width="20" id="img_' +
						ids +
						'" /></a>&nbsp;' +
						'<label id="lab_' + ids + '">10</label>&nbsp;&nbsp;' +
						'<a href="javascript:jb(\'' + ids +
						'\');" style="color:white" title="举报">举报</a>&nbsp;&nbsp;' +
						'<a href="javascript:del_pl(\'' + ids + '\');" style="color:white" title="删除">删除</a>' +
						'</p>' +
						'</div>';
					div.innerHTML = html;
					list.appendChild(div);
					wbk.value = '';
					wbk.onfocus();
				}
			}
		}
		xhr.send(sid);
	}
</script>
<!-- send message info.js-->

<!-- 用户头像 -->
<script>
	document.querySelector("html").onloadstart = function() {
		var xhr = new XMLHttpRequest();
		xhr.open('post', '../api/homepage/profile_photo.php');
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4 && xhr.status == 200) {
				$('profilePhoto').attr('scr', xhr.responseText);
			}
		}
		xhr.send(null);
	}
</script>
